<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--  <mapper namespace="SmartMonitoringDAO">

 	<select id="selectMonitoringDAO" parameterType="comDefaultVO" resultType="egovMap">
		SELECT
			SEQ			AS "seq",
			AUTONUMBER			AS "autonumber",
			REPAIRMETHOD			AS "repairmethod",
			REPAIRNOTE  	AS "repairnote",
			POSITION			AS "position",
			RECEIPTDATE		AS "receipdate",
			ESTIME		AS "estime",
			NOTE		AS "note"
			FROM CAR_TAKEREPAIR
		WHERE 1=1
	</select>


</mapper>  -->
	<mapper	namespace="SmartMonitoringDAO">


	<select id="selectMonitoringList" parameterType="comDefaultVO" resultType="java.util.HashMap">
		
		SELECT
			AUTONUMBER			,
			REPAIRMETHOD		,
			REPAIRNOTE  		,
			RECEIPTDATE			,
			NOTE				,
			TO_CHAR(TO_DATE( SUBSTR(ESTIME,1, REGEXP_INSTR(ESTIME,'[:]+', 14)-1 ), 'YYYY-MM-DD HH24:MI'), 'HH24:MI') AS ESTIME,
			FN_CODENAME(TASKSTAT, 'AUTO_PROC') taskstat,
			FN_CODENAME(POSITION, 'AUTO_ROOM') position
		FROM CAR_TAKEREPAIR
		WHERE  TASKSTAT IN ('CB-repaired', 'CB-standby', 'CB-receipt') 
		OR     (TO_DATE( SUBSTR(ESTIME,1, REGEXP_INSTR(ESTIME,'[:]+', 14)-1 ), 'YYYY-MM-DD HH24:MI') > SYSDATE + 0.0011 AND TASKSTAT = 'CB-perfect')
		ORDER BY ESTIME ASC
	</select>
</mapper>