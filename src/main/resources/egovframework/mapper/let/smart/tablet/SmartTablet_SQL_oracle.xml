<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="SmartTabletDAO">

	<select id="selectList" parameterType="egovframework.smart.tablet.service.SmartTabletVO" resultType="java.util.HashMap">
		
    	SELECT TAKESEQ,
       			TO_CHAR(RECEIPTDATE, 'YYYY-MM-DD HH24:MI')  RECEIPTDATE,
			 	AUTONUMBER,
       			CUSTOMER_AUTOKIND,
       			CUSTOMER_NAME,
            	CUSTOMER_TEL, 
       			REPAIR_ENUM(TAKESEQ) REPAIRCODE_NAME, 
       			FN_CODENAME(POSITION, 'AUTO_ROOM') POSITION_NAME,
       			A.POSITION,
       			B.KILRO_TOTAL,
       			A.KILRO_NOW,
       			ESTIME, 
       			FN_CODENAME(REPAIRMETHOD, 'AUTO_ME') REPAIRMETHOD_NAME,
       			A.TASKSTAT,
       			FN_CODENAME(TASKSTAT, 'AUTO_PROC') TASKSTAT_NAME
			FROM   CAR_TAKEREPAIR A, CAR_CUSTOMER B
			WHERE  A.CUSTOMER_ID = B.CUSTOMER_ID
			AND A.TASKSTAT != 'CB-receipt'
			
			<if test="autoroom != ''">
			AND A.POSITION LIKE '%' || #{autoroom} || '%'
			</if>
	</select>

	<select id="assignmentList" parameterType="egovframework.smart.tablet.service.SmartTabletVO" resultType="java.util.HashMap">
		
     SELECT TAKESEQ,
			TO_CHAR(RECEIPTDATE, 'YYYY-MM-DD HH24:MI')  RECEIPTDATE,
			AUTONUMBER,
			CUSTOMER_AUTOKIND,
			CUSTOMER_NAME,
			CUSTOMER_TEL, 
			REPAIR_ENUM(TAKESEQ) REPAIRCODE_NAME, 
			FN_LEADTIME_NAME(REPAIRCODE, 'LEAD_TIME') LEADTIME,
			TOTAL_LEADTIME,
			FN_CODENAME(FN_LEADTIME_NAME(REPAIRCODE, 'LEAD_TIME'),'LEADTIME') LEADTIME_NM,
			POSITION,
			FN_CODENAME(POSITION, 'AUTO_ROOM') AS POSITION_NAME,
			ESTIME,
			FN_CODENAME(REPAIRMETHOD, 'AUTO_ME') REPAIRMETHOD_NAME,
			FN_CODENAME(TASKSTAT, 'AUTO_PROC') TASKSTAT_NAME
		FROM   CAR_TAKEREPAIR A, CAR_CUSTOMER B
		WHERE  A.CUSTOMER_ID = B.CUSTOMER_ID
			AND A.POSITION IS NULL
			AND A.TASKSTAT = 'CB-receipt'
			
		<if test="searchcarnum != ''">
			AND A.AUTONUMBER LIKE '%' || #{searchcarnum} || '%'
		</if>
		<if test="searchTel != ''">
			AND B.CUSTOMER_TEL LIKE '%' || #{searchTel} || '%'
		</if>
		<if test="searchname != ''">
			AND B.CUSTOMER_NAME LIKE '%' || #{searchname} || '%'
		</if>
	</select>
	
	<update id="UpdateAssign" parameterType="egovframework.smart.tablet.service.SmartTabletVO">
		UPDATE CAR_TAKEREPAIR
		SET
			POSITION = #{autoroom},
			NOTE = #{remark},
			TASKSTAT = 'CB-standby'
			
			WHERE TAKESEQ = #{seq}
	
	</update>
	
		<select id="checkstatus" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		
    	SELECT TAKESEQ,
			TASKSTAT
      FROM CAR_TAKEREPAIR 
      WHERE TAKESEQ = #{seq} AND TASKSTAT = #{taskstat}
	</select>
	
	<update id="updatestatus" parameterType="java.util.HashMap">
		UPDATE CAR_TAKEREPAIR
		SET
			TASKSTAT = #{update_taskstat}
			
			WHERE TAKESEQ = #{seq}
	
	</update>
	<select id="receiveList" parameterType="egovframework.smart.tablet.service.SmartTabletVO" resultType="java.util.HashMap">
		
    	SELECT TAKESEQ,
       			TO_CHAR(RECEIPTDATE, 'YYYY-MM-DD HH24:MI')  RECEIPTDATE,
			 	AUTONUMBER,
       			CUSTOMER_AUTOKIND,
       			CUSTOMER_NAME,
            	CUSTOMER_TEL, 
       			FN_LEADTIME_NAME(REPAIRCODE, 'NAME') REPAIRCODE_NAME,
       			FN_CODENAME(POSITION, 'AUTO_ROOM') POSITION_NAME,
       			A.POSITION,
       			ESTIME, 
       			FN_CODENAME(REPAIRMETHOD, 'AUTO_ME') REPAIRMETHOD_NAME,
       			A.TASKSTAT,
       			FN_CODENAME(TASKSTAT, 'AUTO_PROC') TASKSTAT_NAME
			FROM   CAR_TAKEREPAIR A, CAR_CUSTOMER B
			WHERE  A.CUSTOMER_ID = B.CUSTOMER_ID
			AND A.TASKSTAT != 'CB-perfect'
			AND A.TASKSTAT != 'CB-receipt'
			
			<if test="autoroom != ''">
				AND A.POSITION != #{autoroom}
			</if>
			
	</select>
	<insert id="insertlog" parameterType="java.util.HashMap">
		INSERT INTO CAR_TRANSFERPROC
        (SEQ,TASKSEQ,TRANS_EVENT,TRANS_DATE,SOURCE_POSITION,TARGET_POSITION,NOTE)
        VALUES ( SIRA('CAR_TRANSFERPROC', 'SEQ'),#{seq},'Income',SYSDATE,#{position},#{room},#{remark})    
	</insert>
	
	<update id="Transfergroup" parameterType="java.util.HashMap">
		UPDATE CAR_TAKEREPAIR
		SET
			POSITION = #{room},
			NOTE = #{remark}
			
		WHERE TAKESEQ = #{seq}
	</update>
	
	<select id="detailList" parameterType="egovframework.smart.tablet.service.SmartTabletVO" resultType="java.util.HashMap">
		
    	SELECT TAKESEQ,
       			TO_CHAR(RECEIPTDATE, 'YYYY-MM-DD HH24:MI')  RECEIPTDATE,
			 	AUTONUMBER,
       			CUSTOMER_AUTOKIND,
       			CUSTOMER_NAME,
            	CUSTOMER_TEL, 
       			REPAIR_ENUM(TAKESEQ) REPAIRCODE_NAME, 
       			FN_CODENAME(POSITION, 'AUTO_ROOM') POSITION_NAME,
       			A.POSITION,
       			B.KILRO_TOTAL,
       			A.KILRO_NOW,
       			ESTIME, 
       			FN_CODENAME(REPAIRMETHOD, 'AUTO_ME') REPAIRMETHOD_NAME,
       			A.TASKSTAT,
       			FN_CODENAME(TASKSTAT, 'AUTO_PROC') TASKSTAT_NAME
			FROM   CAR_TAKEREPAIR A, CAR_CUSTOMER B
			WHERE  A.CUSTOMER_ID = B.CUSTOMER_ID
			AND A.TASKSTAT = 'CB-perfect'
			
			<if test="searchcarnum != ''">
			AND A.AUTONUMBER LIKE '%' || #{searchcarnum} || '%'
			</if>
			<if test="searchTel != ''">
			AND B.CUSTOMER_TEL LIKE '%' || #{searchTel} || '%'
			</if>
			<if test="sdate != '' and edate != '' ">
			AND TO_CHAR(A.RECEIPTDATE,'YYYY-MM-DD')>= #{sdate} AND #{edate} >= TO_CHAR(A.RECEIPTDATE,'YYYY-MM-DD') 
			</if>
			<if test="sdate != '' and edate == '' ">
			AND TO_CHAR(A.RECEIPTDATE,'YYYY-MM-DD')>= #{sdate} 
			</if>
			<if test="edate != '' and sdate == '' ">
			AND #{edate}>= TO_CHAR(A.RECEIPTDATE,'YYYY-MM-DD') 
			</if>
			<if test="searchteam != ''">
			AND A.POSITION LIKE '%' || #{searchteam} || '%'
			</if>
	</select>
</mapper>