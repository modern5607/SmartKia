<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="smartCrmDAO">


	<select id="selectCrmList" parameterType="egovframework.smart.crm.service.SmartCrmVO" resultType="java.util.HashMap">
		SELECT
		TAKESEQ,
		TO_CHAR(RECEIPTDATE, 'YYYY-MM-DD HH24:MI') RECEIPTDATE,
		A.CUSTOMER_ID as "cusId",
		A.CUSTOMER_AUTONO as "cusAutoNo",
		A.CUSTOMER_AUTOKIND as "cusAutoKind",
		FN_CODENAME(POSITION, 'AUTO_ROOM') POSITION_NAME,
		A.CUSTOMER_NAME as "cusNm",
		A.CUSTOMER_TEL as "cusTel",
		FN_CODENAME(REPAIRMETHOD, 'AUTO_ME') REPAIRMETHOD_NAME,
		B.NOTE as "note",
		B.TURNOVER as "turnOver",
		B.TURNOVERTIME as "turnOverTime",
		B.TURNOVER_NOTE as "turnOverNote"

		FROM CAR_CUSTOMER A, CAR_TAKEREPAIR B
		WHERE A.CUSTOMER_ID = B.CUSTOMER_ID
		
		
        <if test="searchAutoNo != ''">
            AND A.CUSTOMER_AUTONO LIKE '%' ||#{searchAutoNo}|| '%'
        </if>
        <if test="searchCusNm != ''">
            AND A.CUSTOMER_NAME LIKE '%' ||#{searchCusNm}|| '%'
        </if>
        <if test="searchCusTel != ''">
            AND A.CUSTOMER_TEL LIKE '%' ||#{searchCusTel}|| '%'
        </if>
        <if test="(sdate != null and edate != null)">
        	AND TO_CHAR(RECEIPTDATE, 'YYYY-MM-DD HH24:MI') between #{sdate_dt} and #{edate_dt}
        </if>
		
	</select>
   	<select id="selectCrmListTotCnt" parameterType="egovframework.smart.crm.service.SmartCrmVO" resultType="int">
		
			SELECT 	COUNT(*) totcnt
			FROM 	CAR_CUSTOMER A, CAR_TAKEREPAIR B 
			WHERE 	A.CUSTOMER_ID = B.CUSTOMER_ID
			<!-- <if test="searchCondition == &quot;qestnSj&quot;">AND
				C.CUSTOMER_ID, LIKE '%' || #{searchKeyword} || '%'
			</if> -->
	</select>
</mapper>