<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="smartMberManageDAO">


<!-- 	<resultMap id="SmartMberManageVO" type="egovframework.smart.mdm.mber.service.SmartMberMangeVO">
		<result property="userTy" column="ESNTL_ID"/>
		<result property="userId" column="MBER_ID"/>
		<result property="userNm" column="MBER_NM"/>
		<result property="emailAdres" column="MBER_EMAIL_ADRES"/>
		<result property="areaNo" column="AREA_NO"/>
		<result property="middleTelno" column="MIDDLE_TELNO"/>
		<result property="endTelno" column="END_TELNO"/>
		<result property="moblphonNo" column="MBTLNUM"/>
		<result property="middleMoblphonNo" column="MIDDLE_MBTLNUM"/>		
		<result property="endMoblphonNo" column="END_MBTLNUM"/>
		<result property="groupId" column="GROUP_ID"/>
		<result property="sttus" column="MBER_STTUS"/>
		<result property="sbscrbDe" column="SBSCRB_DE"/>				
	</resultMap> -->
	
    <resultMap id="stplatMap" type="egovframework.smart.mdm.mber.service.StplatVO">
        <result property="useStplatId" column="USE_STPLAT_ID"/>
        <result property="useStplatCn" column="USE_STPLAT_CN"/>
        <result property="infoProvdAgeCn" column="INFO_PROVD_AGRE_CN"/>
    </resultMap>
    
 <select id="selectMberList" parameterType="egovframework.smart.mdm.mber.service.egovframework.let.uss.umt.service.UserDefaultVO" resultType="egovMap">
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
    SELECT 
        ESNTL_ID               as "uniqId",
        'USR01'               as "userTy",
        MBER_ID               as "userId",
        MBER_NM               as "userNm",
        MBER_EMAIL_ADRES      as "emailAdres",
        AREA_NO               as "areaNo",
        MIDDLE_TELNO          as "middleTelno",
        END_TELNO             as "endTelno",
        MBTLNUM           	  as "moblphonNo",
        MIDDLE_MBTLNUM        as "middleMoblphonNo",
        END_MBTLNUM			  as "endMoblphonNo",
        GROUP_ID              as "groupId",
        MBER_STTUS            as "Sttus",
        SBSCRB_DE             as "sbscrbDe"
    FROM    LETTNGNRLMBER
    WHERE 1=1
        <if test='sbscrbSttus != "0"'>
            AND MBER_STTUS LIKE  #{sbscrbSttus}
        </if>
        <if test="searchCondition == 0">
            AND MBER_ID LIKE '%' ||#{searchKeyword}|| '%'
        </if>
        <if test="searchCondition == 1">
            AND MBER_NM LIKE '%' ||#{searchKeyword}|| '%'
        </if> 
        ORDER BY 12 DESC
        ) TB ) WHERE rn BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordCountPerPage}
    </select>
    
    
        <select id="selectMberListTotCnt" parameterType="egovframework.smart.mdm.mber.service.UserDefaultVO" resultType="int">
            SELECT COUNT(1) totcnt
            FROM   LETTNGNRLMBER
            WHERE 1=1
            <if test='sbscrbSttus != "0"'>
                AND MBER_STTUS LIKE  #{sbscrbSttus}
            </if>
            <if test="searchCondition == 0">
                AND MBER_ID LIKE #{searchKeyword}
            </if>
            <if test="searchCondition == 1">
                AND MBER_NM LIKE '%' ||#{searchKeyword}|| '%'
            </if>
    </select>
    
    <insert id="insertMber_S">
        
            INSERT INTO LETTNGNRLMBER 
                (   
                    ESNTL_ID          ,
                    MBER_ID          ,
                    MBER_NM          ,
                    PASSWORD         ,
                    PASSWORD_HINT    ,
                    PASSWORD_CNSR    ,
                    IHIDNUM          ,
                    SEXDSTN_CODE     ,
                    ZIP              ,
                    ADRES            ,
                    AREA_NO          ,
                    MBER_STTUS       ,
                    DETAIL_ADRES     ,
                    END_TELNO        ,
                    MBTLNUM      	 ,
                    MIDDLE_MBTLNUM	 ,
        			END_MBTLNUM		 ,
                    GROUP_ID         ,
                    MBER_FXNUM       ,
                    MBER_EMAIL_ADRES ,
                    MIDDLE_TELNO     ,
                    SBSCRB_DE        )
              VALUES(
                    #{uniqId},
                    #{mberId},
                    #{mberNm},
                    #{password},
                    #{passwordHint},
                    #{passwordCnsr},
                    #{ihidnum},
                    #{sexdstnCode},
                    #{zip},
                    #{adres},
                    #{areaNo},
                    #{mberSttus},
                    #{detailAdres},
                    #{endTelno},
                    #{moblphonNo},
                    #{middleMoblphonNo},
                    #{endMoblphonNo},
                    #{groupId},
                    #{mberFxnum},
                    #{mberEmailAdres},
                    #{middleTelno},
                    sysdate  )              
        
    </insert>
    
    <delete id="deleteMber_S">
        
            DELETE FROM LETTNGNRLMBER 
            WHERE ESNTL_ID=#{delId}
        
    </delete>
    
    <select id="selectMber_S" resultType="egovframework.smart.mdm.mber.service.SmartMberManageVO">
        
            SELECT
                ESNTL_ID          uniqId,
                'USR01'          userTy,
                MBER_ID          mberId,
                MBER_NM          mberNm,
                PASSWORD         password,
                PASSWORD_HINT    passwordHint,
                PASSWORD_CNSR    passwordCnsr,
                IHIDNUM          ihidnum,
                SEXDSTN_CODE     sexdstnCode,
                ZIP              zip,
                ADRES            adres,
                AREA_NO          areaNo,
                MBER_STTUS       mberSttus,
                DETAIL_ADRES     detailAdres,
                END_TELNO        endTelno,
                MBTLNUM      	 moblphonNo,
        		MIDDLE_MBTLNUM   middleMoblphonNo,
       			END_MBTLNUM      endMoblphonNo,
                GROUP_ID         groupId,
                MBER_FXNUM       mberFxnum,
                MBER_EMAIL_ADRES mberEmailAdres,
                MIDDLE_TELNO     middleTelno,
                SBSCRB_DE        sbscrbDe
            FROM LETTNGNRLMBER
            WHERE ESNTL_ID=#{uniqId}
        
    </select>
    
    <update id="updateMber_S">
        
            UPDATE LETTNGNRLMBER 
            SET MBER_ID          = #{mberId},
                MBER_NM          = #{mberNm},
                PASSWORD_HINT    = #{passwordHint},
                PASSWORD_CNSR    = #{passwordCnsr},
                IHIDNUM          = #{ihidnum},
                SEXDSTN_CODE     = #{sexdstnCode},
                ZIP              = #{zip},
                ADRES            = #{adres},
                AREA_NO          = #{areaNo},
                MBER_STTUS       = #{mberSttus},
                DETAIL_ADRES     = #{detailAdres},
                END_TELNO        = #{endTelno},
                MBTLNUM      	 = #{moblphonNo},
        		MIDDLE_MBTLNUM   = #{middleMoblphonNo},
        		END_MBTLNUM      = #{endMoblphonNo},
                GROUP_ID         = #{groupId},
                MBER_FXNUM       = #{mberFxnum},
                MBER_EMAIL_ADRES = #{mberEmailAdres},
                MIDDLE_TELNO     = #{middleTelno}
            WHERE ESNTL_ID=#{uniqId}
        
    </update>
    
    <select id="selectStplat_S" resultMap="stplatMap">
        
            SELECT
                USE_STPLAT_ID           ,
                USE_STPLAT_CN           ,
                INFO_PROVD_AGRE_CN      
            FROM LETTNSTPLATINFO
            WHERE USE_STPLAT_ID=#{stplatId}
        
    </select>
    
    <update id="updatePassword_S">
        
            UPDATE LETTNGNRLMBER 
            SET 
                   PASSWORD   =  #{password}
            WHERE  ESNTL_ID  = #{uniqId}
        
    </update>
    
    <select id="selectPassword_S" resultType="egovframework.smart.mdm.mber.service.SmartMberManageVO">
        
            SELECT
                    PASSWORD          password 
            FROM    LETTNGNRLMBER
            WHERE   ESNTL_ID=#{uniqId}
        
    </select>
    
    
     <select id="checkIdDplct_S" resultType="int">
     
         SELECT COUNT(1) usedCnt
             FROM(
             SELECT
                 EMPLYR_ID             userId
             FROM    LETTNEMPLYRINFO
             UNION ALL
             SELECT
                 ENTRPRS_MBER_ID        userId
             FROM    LETTNENTRPRSMBER
             UNION ALL
             SELECT
                 MBER_ID               userId
             FROM    LETTNGNRLMBER
             ) A
         WHERE userId = #{checkId}
     
    </select>
</mapper>