<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cusMberManageDAO">


    <resultMap id="stplatMap" type="egovframework.smart.customer.service.StplatVO">
        <result property="useStplatId" column="USE_STPLAT_ID"/>
        <result property="useStplatCn" column="USE_STPLAT_CN"/>
        <result property="infoProvdAgeCn" column="INFO_PROVD_AGRE_CN"/>
    </resultMap>
    
    <select id="selectMberList" parameterType="egovframework.smart.customer.service.CusMberManageVO" resultType="egovMap">
  	SELECT * FROM ( SELECT rownum rn, TB.* FROM (
  	SELECT  
        CUSTOMER_ID           as "cusId",
        CUSTOMER_NAME         as "cusNm",
        CUSTOMER_AUTONO       as "autoNo",
        CUSTOMER_AUTOKIND     as "autoKind",
        CUSTOMER_TEL          as "cusTel",
        USE_YN                as "useYN",
        NOTE                  as "note",
        AUTOINT				  as "autoInt",
        KILRO_TOTAL			  as "totalKm"
    FROM    CAR_CUSTOMER
    WHERE 1=1
        <if test="searchcarNum != ''">
            AND UPPER(CUSTOMER_AUTOKIND) LIKE '%' ||UPPER(#{searchcarNum})|| '%'
        </if>
        <if test="searchTel != ''">
            AND REPLACE(CUSTOMER_TEL, '-', '') LIKE '%' ||#{searchTel}|| '%'
        </if>
        <!-- <if test="searchcusNm != ''">
            AND CUSTOMER_NAME LIKE '%' ||#{searchcusNm}|| '%'
        </if> -->
        
        ORDER BY 1,2 DESC) <!-- 오더바이옆에있는 숫자를 기준으로 정렬  -->
        TB ) WHERE rn BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordCountPerPage}
    </select>
    
    <select id="selectMberListTotCnt" parameterType="egovframework.smart.customer.service.CusMberDefaultVO" resultType="int">
            SELECT COUNT(1) totcnt
            FROM   CAR_CUSTOMER
            WHERE 1=1
            <if test="searchcarNum != ''">
	            AND UPPER(CUSTOMER_AUTOKIND) LIKE '%' ||UPPER(#{searchcarNum})|| '%'
	        </if>
			<if test="searchTel != ''">
	            AND REPLACE(CUSTOMER_TEL, '-', '') LIKE '%' ||#{searchTel}|| '%'
	        </if>
	        <!-- <if test="searchcusNm != ''">
	            AND CUSTOMER_NAME LIKE '%' ||#{searchcusNm}|| '%'
	        </if> -->
	         
    </select>
    
    <insert id="insertMber_S">
        
            INSERT INTO CAR_CUSTOMER 
                (   
                    CUSTOMER_ID         ,
                    CUSTOMER_NAME       ,
                    CUSTOMER_AUTONO     ,
                    CUSTOMER_AUTOKIND   ,
                    CUSTOMER_TEL    	,
                    NOTE    			,
					AUTOINT				,
       				KILRO_TOTAL)
              VALUES(
                    SIRA('CAR_CUSTOMER', 'CUSTOMER_ID'),
                    #{cusNm},
                    #{autoNo},
                    #{autoKind},
                    #{cusTel},
                    #{note},
                    #{autoInt},
                    #{totalKm}
                    )              
    </insert>
    
    <delete id="deleteMber_S">
        
            DELETE FROM LETTNGNRLMBER 
            WHERE ESNTL_ID=#{delId}
        
    </delete>
    
    <select id="selectMber_S" resultType="egovframework.smart.customer.service.CusMberManageVO">
        
            SELECT
                ESNTL_ID          uniqId,
                'USR01'          userTy,
                MBER_ID          mberId,
                MBER_NM          mberNm,
                PASSWORD         password,
                PASSWORD_HINT    passwordHint,
                PASSWORD_CNSR    passwordCnsr,
                IHIDNUM          ihidnum,
                SEXDSTN_CODE     sexdstnCode,
                ZIP              zip,
                ADRES            adres,
                TELNO          telNo,
                MBER_STTUS       mberSttus,
                DETAIL_ADRES     detailAdres,
                END_TELNO        endTelno,
                MBTLNUM      moblphonNo,
                GROUP_ID         groupId,
                MBER_FXNUM       mberFxnum,
                MBER_EMAIL_ADRES mberEmailAdres,
                MIDDLE_TELNO     middleTelno,
                SBSCRB_DE        sbscrbDe
            FROM LETTNGNRLMBER
            WHERE ESNTL_ID=#{uniqId}
        
    </select>
    
    <update id="updateMber_S">
        
            UPDATE CAR_CUSTOMER 
            SET CUSTOMER_AUTONO         = #{autoNo},
                CUSTOMER_AUTOKIND       = #{autoKind},
                CUSTOMER_NAME    		= #{cusNm},
                CUSTOMER_TEL    		= #{cusTel},
                NOTE     				= #{note}
            WHERE CUSTOMER_ID=#{cusId}
        
    </update>
    
    <select id="selectStplat_S" resultMap="stplatMap">
        
            SELECT
                USE_STPLAT_ID           ,
                USE_STPLAT_CN           ,
                INFO_PROVD_AGRE_CN      
            FROM LETTNSTPLATINFO
            WHERE USE_STPLAT_ID=#{stplatId}
        
    </select>
    
    <update id="updatePassword_S">
        
            UPDATE LETTNGNRLMBER 
            SET 
                   PASSWORD   =  #{password}
            WHERE  ESNTL_ID  = #{uniqId}
        
    </update>
    
    <select id="selectPassword_S" resultType="egovframework.smart.customer.service.CusMberManageVO">
        
            SELECT
                    PASSWORD          password 
            FROM    LETTNGNRLMBER
            WHERE   ESNTL_ID=#{uniqId}
        
    </select>
    
    
     <select id="checkCusDplct" resultType="int">
     
       	SELECT COUNT(*) cnt 
		FROM CAR_CUSTOMER
		WHERE CUSTOMER_AUTONO = #{autoNo}
		AND CUSTOMER_NAME = #{cusNm}
     
    </select>
</mapper>